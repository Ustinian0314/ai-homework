<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>AI Workspace</title>
  <link rel="stylesheet" href="style.css">
  <script>
    // è¨­å‚™æª¢æ¸¬å’ŒéŸ¿æ‡‰å¼é…ç½®
    window.DeviceDetector = {
      // æª¢æ¸¬è¨­å‚™é¡å‹
      detectDevice: function() {
        const userAgent = navigator.userAgent.toLowerCase();
        const screenWidth = window.innerWidth;
        const screenHeight = window.innerHeight;
        const pixelRatio = window.devicePixelRatio || 1;
        
        // iPhone æª¢æ¸¬
        const isIPhone = /iphone/.test(userAgent);
        // iPad æª¢æ¸¬
        const isIPad = /ipad/.test(userAgent) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
        // Android æ‰‹æ©Ÿæª¢æ¸¬
        const isAndroidPhone = /android/.test(userAgent) && /mobile/.test(userAgent);
        // Android å¹³æ¿æª¢æ¸¬
        const isAndroidTablet = /android/.test(userAgent) && !/mobile/.test(userAgent);
        
        // æ ¹æ“šå±å¹•å°ºå¯¸é€²ä¸€æ­¥åˆ¤æ–·
        let deviceType = 'desktop';
        let deviceModel = 'unknown';
        
        if (isIPhone) {
          deviceType = 'mobile';
          // æª¢æ¸¬å…·é«”iPhoneå‹è™Ÿ
          if (screenWidth === 375 && screenHeight === 667) deviceModel = 'iPhone 6/7/8';
          else if (screenWidth === 414 && screenHeight === 896) deviceModel = 'iPhone 11/XR';
          else if (screenWidth === 375 && screenHeight === 812) deviceModel = 'iPhone X/XS/11 Pro';
          else if (screenWidth === 414 && screenHeight === 926) deviceModel = 'iPhone 12/13/14 Pro Max';
          else if (screenWidth === 390 && screenHeight === 844) deviceModel = 'iPhone 12/13/14';
          else deviceModel = 'iPhone';
        } else if (isIPad) {
          deviceType = 'tablet';
          if (screenWidth === 768 && screenHeight === 1024) deviceModel = 'iPad';
          else if (screenWidth === 834 && screenHeight === 1112) deviceModel = 'iPad Pro 10.5"';
          else if (screenWidth === 1024 && screenHeight === 1366) deviceModel = 'iPad Pro 12.9"';
          else if (screenWidth === 820 && screenHeight === 1180) deviceModel = 'iPad Air 4th/5th';
          else if (screenWidth === 834 && screenHeight === 1194) deviceModel = 'iPad Air 3rd';
          else if (screenWidth === 1024 && screenHeight === 1366) deviceModel = 'iPad Pro 12.9"';
          else if (screenWidth === 1024 && screenHeight === 1366) deviceModel = 'iPad Pro 12.9"';
          else deviceModel = 'iPad';
        } else if (isAndroidPhone) {
          deviceType = 'mobile';
          deviceModel = 'Android Phone';
        } else if (isAndroidTablet) {
          deviceType = 'tablet';
          deviceModel = 'Android Tablet';
        } else if (screenWidth < 768) {
          deviceType = 'mobile';
          deviceModel = 'Small Screen';
        } else if (screenWidth < 1024) {
          deviceType = 'tablet';
          deviceModel = 'Medium Screen';
        }
        
        return {
          type: deviceType,
          model: deviceModel,
          width: screenWidth,
          height: screenHeight,
          pixelRatio: pixelRatio,
          isTouch: 'ontouchstart' in window || navigator.maxTouchPoints > 0
        };
      },
      
      // æ‡‰ç”¨éŸ¿æ‡‰å¼é…ç½®
      applyResponsiveConfig: function(deviceInfo) {
        const body = document.body;
        const container = document.querySelector('.container');
        
        // æ¸…é™¤ä¹‹å‰çš„è¨­å‚™é¡åˆ¥
        body.classList.remove('device-mobile', 'device-tablet', 'device-desktop');
        body.classList.remove('device-iphone', 'device-ipad', 'device-android');
        
        // æ·»åŠ è¨­å‚™é¡å‹é¡åˆ¥
        body.classList.add(`device-${deviceInfo.type}`);
        
        // æ·»åŠ å…·é«”è¨­å‚™é¡åˆ¥
        if (deviceInfo.model.includes('iPhone')) {
          body.classList.add('device-iphone');
        } else if (deviceInfo.model.includes('iPad')) {
          body.classList.add('device-ipad');
        } else if (deviceInfo.model.includes('Android')) {
          body.classList.add('device-android');
        }
        
        // æ ¹æ“šè¨­å‚™é¡å‹èª¿æ•´ä½ˆå±€
        if (deviceInfo.type === 'mobile') {
          this.applyMobileLayout(deviceInfo);
        } else if (deviceInfo.type === 'tablet') {
          this.applyTabletLayout(deviceInfo);
        } else {
          this.applyDesktopLayout(deviceInfo);
        }
        
        // è¨­ç½®CSSè®Šé‡
        document.documentElement.style.setProperty('--device-width', deviceInfo.width + 'px');
        document.documentElement.style.setProperty('--device-height', deviceInfo.height + 'px');
        document.documentElement.style.setProperty('--device-ratio', deviceInfo.pixelRatio);
        
        console.log('è¨­å‚™æª¢æ¸¬å®Œæˆ:', deviceInfo);
      },
      
      // æ‰‹æ©Ÿä½ˆå±€é…ç½®
      applyMobileLayout: function(deviceInfo) {
        const container = document.querySelector('.container');
        const leftSidebar = document.querySelector('.left-sidebar');
        const rightSidebar = document.querySelector('.right-sidebar');
        const mainContent = document.querySelector('.main-content');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const rightSidebarToggle = document.getElementById('rightSidebarToggle');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        
        // æ‰‹æ©Ÿç«¯ï¼šé¡¯ç¤ºæ‰€æœ‰åˆ‡æ›æŒ‰éˆ•
        if (sidebarToggle) {
          sidebarToggle.style.display = 'flex';
        }
        if (rightSidebarToggle) {
          rightSidebarToggle.style.display = 'flex';
        }
        
        // æ‰‹æ©Ÿç«¯ï¼šå´é‚Šæ¬„é»˜èªéš±è—ï¼ŒiPadé¢¨æ ¼æ¨£å¼
        if (leftSidebar) {
          leftSidebar.style.display = 'flex';
          leftSidebar.style.position = 'fixed';
          leftSidebar.style.top = '60px';
          leftSidebar.style.left = '-100%';
          leftSidebar.style.width = '85vw';
          leftSidebar.style.maxWidth = '400px';
          leftSidebar.style.height = 'calc(100vh - 60px)';
          leftSidebar.style.zIndex = '1000';
          leftSidebar.style.backgroundColor = '#2d2d2d';
          leftSidebar.style.border = '1px solid #4a4a4a';
          leftSidebar.style.borderRadius = '0 16px 16px 0';
          leftSidebar.style.boxShadow = '4px 0 20px rgba(0, 0, 0, 0.25)';
          leftSidebar.style.overflowY = 'auto';
          leftSidebar.style.padding = '20px';
          leftSidebar.classList.remove('show');
        }
        
        // ç‚ºæ‰‹æ©Ÿç«¯æ·»åŠ é–“è·å®¹å™¨é¡
        const chatContainer = document.querySelector('.chat-container');
        const conversationSection = document.querySelector('.conversation-section');
        if (chatContainer) {
          chatContainer.classList.add('chat-container');
        }
        if (conversationSection) {
          conversationSection.classList.add('conversation-section');
        }
        
        if (rightSidebar) {
          rightSidebar.style.display = 'flex';
          rightSidebar.style.position = 'fixed';
          rightSidebar.style.top = '60px';
          rightSidebar.style.right = '-100%';
          rightSidebar.style.width = '85vw';
          rightSidebar.style.maxWidth = '400px';
          rightSidebar.style.height = 'calc(100vh - 60px)';
          rightSidebar.style.zIndex = '1000';
          rightSidebar.style.backgroundColor = '#2d2d2d';
          rightSidebar.style.border = '1px solid #4a4a4a';
          rightSidebar.style.borderRadius = '16px 0 0 16px';
          rightSidebar.style.boxShadow = '-4px 0 20px rgba(0, 0, 0, 0.25)';
          rightSidebar.style.overflowY = 'auto';
          rightSidebar.style.padding = '20px';
          rightSidebar.classList.remove('show');
        }
        
        if (sidebarOverlay) {
          sidebarOverlay.classList.remove('show');
        }
        
        if (mainContent) {
          mainContent.style.width = '100%';
          mainContent.style.margin = '0';
          mainContent.style.padding = '16px';
          mainContent.style.borderRadius = '16px';
          mainContent.style.backgroundColor = '#2d2d2d';
          mainContent.style.border = '1px solid #4a4a4a';
          mainContent.style.boxShadow = '0 4px 20px rgba(0, 0, 0, 0.15)';
          mainContent.classList.remove('sidebar-open');
        }
        
        // èª¿æ•´é ‚éƒ¨å°èˆªæ¬„ - iPadé¢¨æ ¼
        const topNavbar = document.querySelector('.top-navbar');
        if (topNavbar) {
          topNavbar.style.padding = '0 16px';
          topNavbar.style.height = '56px';
          topNavbar.style.top = '8px';
          topNavbar.style.left = '8px';
          topNavbar.style.right = '8px';
          topNavbar.style.borderRadius = '16px';
          topNavbar.style.boxShadow = '0 4px 20px rgba(0, 0, 0, 0.15)';
        }
        
        // èª¿æ•´å®¹å™¨é«˜åº¦ - iPadé¢¨æ ¼
        if (container) {
          container.style.height = 'calc(100vh - 60px)';
          container.style.marginTop = '60px';
          container.style.padding = '8px';
          container.style.gap = '8px';
          container.style.backgroundColor = '#1a1a1a';
        }
      },
      
      // å¹³æ¿ä½ˆå±€é…ç½®
      applyTabletLayout: function(deviceInfo) {
        const container = document.querySelector('.container');
        const leftSidebar = document.querySelector('.left-sidebar');
        const rightSidebar = document.querySelector('.right-sidebar');
        const mainContent = document.querySelector('.main-content');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const rightSidebarToggle = document.getElementById('rightSidebarToggle');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        
        // å¹³æ¿ç«¯ï¼šé¡¯ç¤ºæ‰€æœ‰åˆ‡æ›æŒ‰éˆ•
        if (sidebarToggle) {
          sidebarToggle.style.display = 'flex';
        }
        if (rightSidebarToggle) {
          rightSidebarToggle.style.display = 'flex';
        }
        
        if (sidebarOverlay) {
          sidebarOverlay.classList.remove('show');
        }
        
        // å¹³æ¿ç«¯ï¼šå´é‚Šæ¬„é»˜èªéš±è—ï¼Œå°ˆæ³¨å°è©±ï¼Œæ›´èˆ’é©çš„å¤§å°
        // æ ¹æ“šiPadå‹è™Ÿè¨­ç½®ä¸åŒçš„å´é‚Šæ¬„å¯¬åº¦
        let sidebarWidth = '400px';
        if (deviceInfo.model && deviceInfo.model.includes('iPad Pro 12.9')) {
          sidebarWidth = '450px';
        } else if (deviceInfo.model && (deviceInfo.model.includes('iPad Pro 10.5') || deviceInfo.model.includes('iPad Air'))) {
          sidebarWidth = '380px';
        }
        
        if (leftSidebar) {
          leftSidebar.style.display = 'flex';
          leftSidebar.style.position = 'fixed';
          leftSidebar.style.top = '60px';
          leftSidebar.style.left = '-100%';
          leftSidebar.style.width = sidebarWidth;
          leftSidebar.style.height = 'calc(100vh - 60px)';
          leftSidebar.style.zIndex = '1000';
          leftSidebar.classList.remove('show');
        }
        
        if (rightSidebar) {
          rightSidebar.style.display = 'flex';
          rightSidebar.style.position = 'fixed';
          rightSidebar.style.top = '60px';
          rightSidebar.style.right = '-100%';
          rightSidebar.style.width = sidebarWidth;
          rightSidebar.style.height = 'calc(100vh - 60px)';
          rightSidebar.style.zIndex = '1000';
          rightSidebar.classList.remove('show');
        }
        
        if (mainContent) {
          mainContent.style.flex = '1';
          mainContent.style.width = '100%';
          mainContent.style.margin = '0';
          mainContent.classList.remove('sidebar-open', 'left-sidebar-open', 'right-sidebar-open');
          // ç‚ºiPadè¨­ç½®å‹•æ…‹é‚Šè·
          mainContent.setAttribute('data-sidebar-width', sidebarWidth);
        }
        
        // èª¿æ•´é ‚éƒ¨å°èˆªæ¬„
        const topNavbar = document.querySelector('.top-navbar');
        if (topNavbar) {
          topNavbar.style.padding = '0 16px';
          topNavbar.style.height = '55px';
        }
        
        // èª¿æ•´å®¹å™¨
        if (container) {
          container.style.height = 'calc(100vh - 70px)';
          container.style.marginTop = '70px';
          container.style.padding = '0px';
          container.style.gap = '0px';
        }
      },
      
      // æ¡Œé¢ä½ˆå±€é…ç½®
      applyDesktopLayout: function(deviceInfo) {
        const container = document.querySelector('.container');
        const sidebars = document.querySelectorAll('.sidebar');
        const mainContent = document.querySelector('.main-content');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        
        // æ¡Œé¢ç«¯ï¼šéš±è—æ‰€æœ‰å´é‚Šæ¬„åˆ‡æ›æŒ‰éˆ•
        if (sidebarToggle) {
          sidebarToggle.style.display = 'none';
        }
        
        const rightSidebarToggle = document.getElementById('rightSidebarToggle');
        if (rightSidebarToggle) {
          rightSidebarToggle.style.display = 'none';
        }
        
        if (sidebarOverlay) {
          sidebarOverlay.classList.remove('show');
        }
        
        // æ¡Œé¢ç«¯ï¼šé¡¯ç¤ºæ‰€æœ‰å´é‚Šæ¬„ï¼Œæ¢å¾©åŸå§‹ä½ˆå±€
        sidebars.forEach(sidebar => {
          sidebar.style.display = 'flex';
          sidebar.style.position = 'static';
          sidebar.style.width = 'auto';
          sidebar.style.height = 'auto';
          sidebar.style.left = 'auto';
          sidebar.style.right = 'auto';
          sidebar.style.top = 'auto';
          sidebar.style.zIndex = 'auto';
          sidebar.style.backgroundColor = '';
          sidebar.style.border = '';
          sidebar.style.borderRadius = '';
          sidebar.style.boxShadow = '';
          sidebar.style.overflowY = '';
          sidebar.classList.remove('show');
        });
        
        if (mainContent) {
          mainContent.style.flex = '1';
          mainContent.style.width = 'auto';
          mainContent.style.margin = '0';
          mainContent.style.marginLeft = '0';
          mainContent.style.marginRight = '0';
          mainContent.classList.remove('sidebar-open', 'left-sidebar-open', 'right-sidebar-open');
        }
        
        // èª¿æ•´é ‚éƒ¨å°èˆªæ¬„
        const topNavbar = document.querySelector('.top-navbar');
        if (topNavbar) {
          topNavbar.style.padding = '0 20px';
          topNavbar.style.height = '60px';
        }
        
        // èª¿æ•´å®¹å™¨
        if (container) {
          container.style.height = 'calc(100vh - 80px)';
          container.style.marginTop = '80px';
          container.style.padding = '8px';
          container.style.gap = '8px';
        }
      },
      
      // åˆå§‹åŒ–è¨­å‚™æª¢æ¸¬
      init: function() {
        const deviceInfo = this.detectDevice();
        this.applyResponsiveConfig(deviceInfo);
        
        // ç›£è½çª—å£å¤§å°è®ŠåŒ–
        let resizeTimeout;
        window.addEventListener('resize', () => {
          clearTimeout(resizeTimeout);
          resizeTimeout = setTimeout(() => {
            const newDeviceInfo = this.detectDevice();
            this.applyResponsiveConfig(newDeviceInfo);
          }, 250);
        });
        
        // ç›£è½è¨­å‚™æ–¹å‘è®ŠåŒ–
        window.addEventListener('orientationchange', () => {
          setTimeout(() => {
            const newDeviceInfo = this.detectDevice();
            this.applyResponsiveConfig(newDeviceInfo);
          }, 500);
        });
        
        return deviceInfo;
      }
    };
  </script>
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true,
        processEnvironments: true
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
  </script>
  <!-- ç§»é™¤ polyfill.ioï¼Œé¿å… DNS è§£æéŒ¯èª¤ä¸”ç¾ä»£ç€è¦½å™¨é€šå¸¸ä¸éœ€è¦ -->
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  
  <!-- é ‚éƒ¨å°èˆªæ¬„ -->
  <div class="top-navbar">
    <div class="navbar-left">
      <div class="navbar-icon">ğŸ¤–</div>
      <div class="navbar-title">AIä½œæ¥­è¼”å°åŠ©æ‰‹</div>
    </div>
    <div class="navbar-right">
      <button id="sidebarToggle" class="sidebar-toggle-btn" onclick="toggleSidebar()" style="display: none;" title="ä¾†æº">ğŸ“</button>
      <button id="rightSidebarToggle" class="right-sidebar-toggle-btn" onclick="toggleRightSidebar()" style="display: none;" title="å·¥ä½œå®¤">ğŸ“‹</button>
      <button id="loginBtn" class="login-btn" onclick="toggleLoginModal()">ç™»å…¥</button>
    </div>
  </div>

  <div class="container">
    <!-- å´é‚Šæ¬„è¦†è“‹å±¤ -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeAllSidebars()"></div>
    
    <div class="sidebar left-sidebar">
      <!-- ä¾†æºé é¢ -->
      <div id="sourcesPage" class="sidebar-page active">
        <div class="sidebar-header">
          <h3>ä¾†æº</h3>
          <div class="sidebar-actions">
            <input id="fileUpload" type="file" accept="*/*" style="display:none" multiple />
            <input id="cameraInput" type="file" accept="image/*" capture="environment" style="display:none" />
            <button class="new-source-btn" onclick="triggerFileUpload()">+ æ–°å¢</button>
            <button class="camera-btn" onclick="triggerCameraCapture()">ğŸ“· æ‹ç…§</button>
            <button class="search-source-btn" onclick="showExplorePage()">æ¢ç´¢</button>
          </div>
        </div>
        <div class="sidebar-content">
          <div id="sourcesList" class="sources-list">
            <p class="no-sources">é€™è£¡æœƒé¡¯ç¤ºå·²å„²å­˜çš„ä¾†æº</p>
          </div>
        </div>
        <div class="sidebar-footer">
        </div>
      </div>
      
      <!-- æ¢ç´¢é é¢ -->
      <div id="explorePage" class="sidebar-page">
        <div class="sidebar-header">
          <h3>æ¢ç´¢</h3>
          <div class="sidebar-actions">
            <button class="back-to-sources-btn" onclick="showSourcesPage()">â† è¿”å›</button>
          </div>
        </div>
        <div class="sidebar-content">
          <div id="chatHistory" class="chat-history">
            <p class="no-history">é€™è£¡æœƒé¡¯ç¤ºæ­·å²å°è©±</p>
          </div>
        </div>
        <div class="sidebar-footer">
          <span class="history-info">é»æ“Šå°è©±å¯é‡æ–°è¼‰å…¥</span>
        </div>
      </div>
    </div>
    <div class="main-content">
        <div class="chat-header">
            <h3>å°è©± <span id="currentChatLabel" class="current-chat-label"></span></h3>
            <button id="newChatBtn" class="new-chat-btn" onclick="createNewChat()">+ æ–°èŠå¤©</button>
        </div>
        <div class="chat-body">
            <div id="chatMessages" class="chat-messages">
                <!-- èŠå¤©æ¶ˆæ¯æœƒåœ¨é€™è£¡å‹•æ…‹æ·»åŠ  -->
            </div>
        </div>
        <div class="chat-input-area">
            <textarea id="userInput" placeholder="åœ¨æ­¤è¼¸å…¥å°è©±å…§å®¹ï¼Œä¾‹å¦‚ï¼šè«‹å¹«æˆ‘æè¿°é€™å¼µåœ–ç‰‡..." spellcheck="false"></textarea>
            <div class="chat-actions">
                <span id="status" class="status"></span>
                <div class="input-buttons">
                    <button id="voiceBtn" class="voice-btn" type="button" title="èªéŸ³è¼¸å…¥">ğŸ¤</button>
                    <button id="sendBtn" type="button">ç™¼é€è¨Šæ¯</button>
                </div>
            </div>
        </div>
        <div class="request-preview-area">
            <label for="requestView">TestViewï¼ˆæœ€å¾Œä¸€æ¬¡è«‹æ±‚é è¦½ï¼‰</label>
            <textarea id="requestView" readonly></textarea>
        </div>
    </div>
    <div class="sidebar right-sidebar">
      <div class="sidebar-header">
        <h3>å·¥ä½œå®¤</h3>
      </div>
      <div class="workspace-items">
        <div class="workspace-item audio-summary" data-tooltip="æ ¹æ“šç•¶å‰é¡Œç›®æ™ºèƒ½æ¨è–¦ç›¸ä¼¼ç·´ç¿’é¡Œ,éå›ºå­¸ç¿’æ•ˆæœ">
          <div class="item-icon" id="icon-audio-summary">ğŸ“š</div>
          <div class="item-content">
            <span class="item-label">ç›¸ä¼¼é¡Œæ¨è–¦</span>
            <div class="edit-icon" onclick="openIconSelector('audio-summary')">âœï¸</div>
          </div>
          <div class="workspace-actions">
            <button class="workspace-action-btn" onclick="generateSimilarQuestions()">âš™ï¸ ç”¢ç”Ÿç›¸ä¼¼ç·´ç¿’é¡Œ</button>
          </div>
          <div id="similarQuestionsOutput" class="workspace-output"></div>
        </div>
        <div class="workspace-item video-summary" data-tooltip="æ·±å…¥è§£æç›¸é—œçŸ¥è­˜é»,æä¾›å»¶ä¼¸å­¸ç¿’è³‡æ–™">
          <div class="item-icon" id="icon-video-summary">â­</div>
          <div class="item-content">
            <span class="item-label">çŸ¥è­˜é»æ“´å±•</span>
            <div class="edit-icon" onclick="openIconSelector('video-summary')">âœï¸</div>
          </div>
        </div>
        <div class="workspace-item mind-map" data-tooltip="è‡ªå‹•æ”¶é›†éŒ¯é¡Œ,å»ºç«‹å€‹äººå°ˆå±¬è¤‡ç¿’è³‡æ–™åº«">
          <div class="item-icon" id="icon-mind-map">ğŸ“</div>
          <div class="item-content">
            <span class="item-label">éŒ¯é¡Œæœ¬</span>
            <div class="edit-icon" onclick="openIconSelector('mind-map')">âœï¸</div>
          </div>
        </div>
        <div class="workspace-item report" data-tooltip="éš¨æ™‚å‘AIæå•,ç²å¾—å³æ™‚å°ˆæ¥­è§£ç­”">
          <div class="item-icon" id="icon-report">ğŸ’¬</div>
          <div class="item-content">
            <span class="item-label">æ™ºèƒ½å•ç­”</span>
            <div class="edit-icon" onclick="openIconSelector('report')">âœï¸</div>
          </div>
        </div>
      </div>
       <div class="workspace-footer">
        <button>æ–°å¢è¨˜äº‹</button>
      </div>
    </div>
  </div>
  
  <!-- ç™»å…¥æ¨¡æ…‹æ¡† -->
  <div id="loginModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>ç”¨æˆ¶ç™»å…¥</h3>
        <span class="close" onclick="closeLoginModal()">&times;</span>
      </div>
      <div class="modal-body">
        <form id="loginForm" onsubmit="handleLogin(event)">
          <div class="form-group">
            <label for="username">ç”¨æˆ¶åæˆ–éƒµç®±</label>
            <input type="text" id="username" name="username" required>
          </div>
          <div class="form-group">
            <label for="password">å¯†ç¢¼</label>
            <input type="password" id="password" name="password" required>
          </div>
          <div class="form-options">
            <label class="remember-me">
              <input type="checkbox" id="rememberMe" name="rememberMe">
              è¨˜ä½æˆ‘
            </label>
            <a href="#" class="forgot-password">å¿˜è¨˜å¯†ç¢¼ï¼Ÿ</a>
          </div>
          <button type="submit" class="login-submit-btn">ç™»å…¥</button>
        </form>
        <div class="login-footer">
          <p>é‚„æ²’æœ‰å¸³è™Ÿï¼Ÿ <a href="#" onclick="switchToRegister()">ç«‹å³è¨»å†Š</a></p>
        </div>
      </div>
    </div>
  </div>

  <!-- è¨»å†Šæ¨¡æ…‹æ¡† -->
  <div id="registerModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>ç”¨æˆ¶è¨»å†Š</h3>
        <span class="close" onclick="closeRegisterModal()">&times;</span>
      </div>
      <div class="modal-body">
        <form id="registerForm" onsubmit="handleRegister(event)">
          <div class="form-group">
            <label for="regUsername">ç”¨æˆ¶å</label>
            <input type="text" id="regUsername" name="username" required>
          </div>
          <div class="form-group">
            <label for="regEmail">éƒµç®±</label>
            <input type="email" id="regEmail" name="email" required>
          </div>
          <div class="form-group">
            <label for="regPassword">å¯†ç¢¼</label>
            <input type="password" id="regPassword" name="password" required>
          </div>
          <div class="form-group">
            <label for="regConfirmPassword">ç¢ºèªå¯†ç¢¼</label>
            <input type="password" id="regConfirmPassword" name="confirmPassword" required>
          </div>
          <div class="form-group">
            <label for="regFullName">å…¨åï¼ˆå¯é¸ï¼‰</label>
            <input type="text" id="regFullName" name="fullName">
          </div>
          <div class="form-options">
            <label class="agree-terms">
              <input type="checkbox" id="agreeTerms" name="agreeTerms" required>
              æˆ‘åŒæ„ <a href="#" onclick="showTerms()">æœå‹™æ¢æ¬¾</a> å’Œ <a href="#" onclick="showPrivacy()">éš±ç§æ”¿ç­–</a>
            </label>
          </div>
          <button type="submit" class="register-submit-btn">è¨»å†Š</button>
        </form>
        <div class="register-footer">
          <p>å·²æœ‰å¸³è™Ÿï¼Ÿ <a href="#" onclick="switchToLogin()">ç«‹å³ç™»å…¥</a></p>
        </div>
      </div>
    </div>
  </div>

  <!-- åœ–æ¨™é¸æ“‡å™¨æ¨¡æ…‹æ¡† -->
  <div id="iconSelectorModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>é¸æ“‡åœ–æ¨™</h3>
        <span class="close" onclick="closeIconSelector()">&times;</span>
      </div>
      <div class="modal-body">
        <div class="icon-grid">
          <div class="icon-option" onclick="selectIcon('ğŸ“š')">ğŸ“š</div>
          <div class="icon-option" onclick="selectIcon('â­')">â­</div>
          <div class="icon-option" onclick="selectIcon('ğŸ“')">ğŸ“</div>
          <div class="icon-option" onclick="selectIcon('ğŸ’¬')">ğŸ’¬</div>
          <div class="icon-option" onclick="selectIcon('ğŸµ')">ğŸµ</div>
          <div class="icon-option" onclick="selectIcon('ğŸ¬')">ğŸ¬</div>
          <div class="icon-option" onclick="selectIcon('ğŸ§ ')">ğŸ§ </div>
          <div class="icon-option" onclick="selectIcon('ğŸ“Š')">ğŸ“Š</div>
          <div class="icon-option" onclick="selectIcon('ğŸ“š')">ğŸ“š</div>
          <div class="icon-option" onclick="selectIcon('â“')">â“</div>
          <div class="icon-option" onclick="selectIcon('ğŸ”')">ğŸ”</div>
          <div class="icon-option" onclick="selectIcon('ğŸ’¡')">ğŸ’¡</div>
          <div class="icon-option" onclick="selectIcon('ğŸ“–')">ğŸ“–</div>
          <div class="icon-option" onclick="selectIcon('ğŸ¯')">ğŸ¯</div>
          <div class="icon-option" onclick="selectIcon('ğŸ“‹')">ğŸ“‹</div>
          <div class="icon-option" onclick="selectIcon('ğŸ”§')">ğŸ”§</div>
        </div>
      </div>
    </div>
  </div>
  
  <script src="script.js"></script>
  <script>
    // å´é‚Šæ¬„åˆ‡æ›åŠŸèƒ½
    let sidebarOpen = false;
    let rightSidebarOpen = true; // iPad é»˜èªé¡¯ç¤ºå³å´æ¬„
    
    function toggleSidebar() {
      const sidebar = document.querySelector('.left-sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      const mainContent = document.querySelector('.main-content');
      const toggleBtn = document.getElementById('sidebarToggle');
      
      if (sidebarOpen) {
        closeSidebar();
      } else {
        openSidebar();
      }
    }
    
    function openSidebar() {
      // å…ˆé—œé–‰å³å´æ¬„ï¼Œé¿å…è¡çª
      if (rightSidebarOpen) {
        closeRightSidebar();
      }
      
      const sidebar = document.querySelector('.left-sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      const mainContent = document.querySelector('.main-content');
      const toggleBtn = document.getElementById('sidebarToggle');
      
      if (sidebar) {
        sidebar.classList.add('show');
        // ç¢ºä¿æ‰‹æ©Ÿç«¯æ¨£å¼æ­£ç¢º
        if (window.innerWidth < 768) {
          sidebar.style.left = '0';
        }
      }
      if (overlay) overlay.classList.add('show');
      if (mainContent) {
        mainContent.classList.add('left-sidebar-open');
        mainContent.classList.remove('right-sidebar-open');
        // ç‚ºiPadè¨­ç½®å‹•æ…‹é‚Šè·
        if (window.innerWidth >= 768) {
          const sidebarWidth = mainContent.getAttribute('data-sidebar-width') || '400px';
          mainContent.style.marginLeft = sidebarWidth;
        }
      }
      if (toggleBtn) toggleBtn.classList.add('active');
      
      sidebarOpen = true;
    }
    
    function closeSidebar() {
      const sidebar = document.querySelector('.left-sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      const mainContent = document.querySelector('.main-content');
      const toggleBtn = document.getElementById('sidebarToggle');
      
      if (sidebar) {
        sidebar.classList.remove('show');
        // ç¢ºä¿æ‰‹æ©Ÿç«¯æ¨£å¼æ­£ç¢º
        if (window.innerWidth < 768) {
          sidebar.style.left = '-100%';
        }
      }
      if (overlay) overlay.classList.remove('show');
      if (mainContent) {
        mainContent.classList.remove('left-sidebar-open');
        // é‡ç½®iPadçš„ä¸»å…§å®¹å€åŸŸ
        if (window.innerWidth >= 768) {
          mainContent.style.marginLeft = '0';
        }
      }
      if (toggleBtn) toggleBtn.classList.remove('active');
      
      sidebarOpen = false;
    }
    
    // å³å´æ¬„åˆ‡æ›åŠŸèƒ½ï¼ˆé©ç”¨æ–¼æ‰‹æ©Ÿå’Œå¹³æ¿ï¼‰
    function toggleRightSidebar() {
      const rightSidebar = document.querySelector('.right-sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      const mainContent = document.querySelector('.main-content');
      const toggleBtn = document.getElementById('rightSidebarToggle');
      
      if (rightSidebarOpen) {
        closeRightSidebar();
      } else {
        openRightSidebar();
      }
    }
    
    function openRightSidebar() {
      // å…ˆé—œé–‰å·¦å´æ¬„ï¼Œé¿å…è¡çª
      if (sidebarOpen) {
        closeSidebar();
      }
      
      const rightSidebar = document.querySelector('.right-sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      const mainContent = document.querySelector('.main-content');
      const toggleBtn = document.getElementById('rightSidebarToggle');
      
      if (rightSidebar) {
        rightSidebar.classList.add('show');
        rightSidebar.classList.remove('hidden');
        // ç¢ºä¿æ‰‹æ©Ÿç«¯æ¨£å¼æ­£ç¢º
        if (window.innerWidth < 768) {
          rightSidebar.style.right = '0';
        }
      }
      if (overlay) overlay.classList.add('show');
      if (mainContent) {
        mainContent.classList.add('right-sidebar-open');
        mainContent.classList.remove('left-sidebar-open');
        // ç‚ºiPadè¨­ç½®å‹•æ…‹é‚Šè·
        if (window.innerWidth >= 768) {
          const sidebarWidth = mainContent.getAttribute('data-sidebar-width') || '400px';
          mainContent.style.marginRight = sidebarWidth;
        }
      }
      if (toggleBtn) toggleBtn.classList.add('active');
      
      rightSidebarOpen = true;
    }
    
    function closeRightSidebar() {
      const rightSidebar = document.querySelector('.right-sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      const mainContent = document.querySelector('.main-content');
      const toggleBtn = document.getElementById('rightSidebarToggle');
      
      if (rightSidebar) {
        rightSidebar.classList.remove('show');
        rightSidebar.classList.add('hidden');
        // ç¢ºä¿æ‰‹æ©Ÿç«¯æ¨£å¼æ­£ç¢º
        if (window.innerWidth < 768) {
          rightSidebar.style.right = '-100%';
        }
      }
      if (overlay) overlay.classList.remove('show');
      if (mainContent) {
        mainContent.classList.remove('right-sidebar-open');
        // é‡ç½®iPadçš„ä¸»å…§å®¹å€åŸŸ
        if (window.innerWidth >= 768) {
          mainContent.style.marginRight = '0';
        }
      }
      if (toggleBtn) toggleBtn.classList.remove('active');
      
      rightSidebarOpen = false;
    }
    
    // é—œé–‰æ‰€æœ‰å´é‚Šæ¬„
    function closeAllSidebars() {
      closeSidebar();
      closeRightSidebar();
      
      // ç¢ºä¿ä¸»å…§å®¹å€åŸŸé‡ç½®
      const mainContent = document.querySelector('.main-content');
      if (mainContent) {
        mainContent.classList.remove('left-sidebar-open', 'right-sidebar-open');
        // é‡ç½®iPadçš„ä¸»å…§å®¹å€åŸŸ
        if (window.innerWidth >= 768) {
          mainContent.style.marginLeft = '0';
          mainContent.style.marginRight = '0';
        }
      }
    }
    
    // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–è¨­å‚™æª¢æ¸¬
    document.addEventListener('DOMContentLoaded', function() {
      // åˆå§‹åŒ–è¨­å‚™æª¢æ¸¬ç³»çµ±
      const deviceInfo = window.DeviceDetector.init();
      
      // æ·»åŠ è¨­å‚™ä¿¡æ¯åˆ°æ§åˆ¶å°
      console.log('ç•¶å‰è¨­å‚™ä¿¡æ¯:', deviceInfo);
      
      // å¯ä»¥æ ¹æ“šè¨­å‚™é¡å‹åŸ·è¡Œç‰¹å®šé‚è¼¯
      if (deviceInfo.type === 'mobile') {
        console.log('æª¢æ¸¬åˆ°ç§»å‹•è¨­å‚™ï¼Œå·²å•Ÿç”¨æ‰‹æ©Ÿå„ªåŒ–æ¨¡å¼');
        
        // æ‰‹æ©Ÿç«¯èª¿è©¦ä¿¡æ¯
        const leftSidebar = document.querySelector('.left-sidebar');
        const rightSidebar = document.querySelector('.right-sidebar');
        console.log('å·¦å´æ¬„å…ƒç´ :', leftSidebar);
        console.log('å³å´æ¬„å…ƒç´ :', rightSidebar);
        
        if (leftSidebar) {
          console.log('å·¦å´æ¬„æ¨£å¼:', {
            display: leftSidebar.style.display,
            position: leftSidebar.style.position,
            left: leftSidebar.style.left,
            width: leftSidebar.style.width,
            backgroundColor: leftSidebar.style.backgroundColor
          });
        }
        
        if (rightSidebar) {
          console.log('å³å´æ¬„æ¨£å¼:', {
            display: rightSidebar.style.display,
            position: rightSidebar.style.position,
            right: rightSidebar.style.right,
            width: rightSidebar.style.width,
            backgroundColor: rightSidebar.style.backgroundColor
          });
        }
      } else if (deviceInfo.type === 'tablet') {
        console.log('æª¢æ¸¬åˆ°å¹³æ¿è¨­å‚™ï¼Œå·²å•Ÿç”¨å¹³æ¿å„ªåŒ–æ¨¡å¼');
      } else {
        console.log('æª¢æ¸¬åˆ°æ¡Œé¢è¨­å‚™ï¼Œå·²å•Ÿç”¨æ¡Œé¢æ¨¡å¼');
      }
    });
  </script>
</body>
</html>
